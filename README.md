# twowayjack

Stata module for two-way cluster jackknife variance estimation.

For a very detailed description see:

MacKinnon, J.G., Nielsen, M.Ø., Webb, M.D., 2024. [Jackknife inference with two-way clustering](https://arxiv.org/abs/2406.XXXX).    

### nlswork example - using regress

```{stata}
webuse nlswork, clear
keep if inrange(age,25,35)
gen vismin  = inrange(race,2,3)
reg hours vismin south i.age i.birth_yr i.year i.ind   , cluster(ind)

Linear regression                               Number of obs     =     13,754
                                                F(10, 11)         =          .
                                                Prob > F          =          .
                                                R-squared         =     0.0659
                                                Root MSE          =     9.6979

                              (Std. err. adjusted for 12 clusters in ind_code)
------------------------------------------------------------------------------
             |               Robust
       hours | Coefficient  std. err.      t    P>|t|     [95% conf. interval]
-------------+----------------------------------------------------------------
      vismin |   1.054672   .4202197     2.51   0.029     .1297746    1.979569
       south |   1.658992   .4821298     3.44   0.006     .5978318    2.720153
             |
         age |
         26  |  -.1811463   .5861696    -0.31   0.763    -1.471297    1.109004
         27  |  -.3814736   .9447343    -0.40   0.694     -2.46082    1.697872
         28  |  -.2093935   1.440343    -0.15   0.887    -3.379568    2.960781
         29  |  -.8036619   1.767582    -0.45   0.658    -4.694083    3.086759
         30  |  -.7499248   2.219862    -0.34   0.742    -5.635808    4.135959
         31  |  -.4011815   2.562924    -0.16   0.878    -6.042139    5.239776
         32  |   -.379275   2.866923    -0.13   0.897    -6.689331    5.930781
         33  |  -.4643584   3.340661    -0.14   0.892    -7.817104    6.888387
         34  |   -.625297   4.019505    -0.16   0.879    -9.472168    8.221574
         35  |   -.116474   4.373159    -0.03   0.979    -9.741731    9.508783
             |
    birth_yr |
         42  |  -6.237447    2.30784    -2.70   0.021    -11.31697   -1.157924
         43  |  -2.462405   2.146732    -1.15   0.276     -7.18733    2.262521
         44  |  -2.930106   2.232248    -1.31   0.216    -7.843249    1.983038
         45  |  -1.818496   2.481833    -0.73   0.479    -7.280973     3.64398
         46  |  -2.547357   2.582229    -0.99   0.345    -8.230805     3.13609
         47  |  -2.373287    3.38489    -0.70   0.498    -9.823379    5.076805
         48  |  -1.774984   3.374183    -0.53   0.609    -9.201511    5.651544
         49  |  -1.243003   4.011613    -0.31   0.762     -10.0725    7.586498
         50  |  -.6264606   4.131405    -0.15   0.882    -9.719623    8.466702
         51  |  -.5157076   4.474475    -0.12   0.910    -10.36396    9.332545
         52  |  -.6273209   4.803729    -0.13   0.898    -11.20026    9.945616
         53  |  -.4631512   5.157188    -0.09   0.930    -11.81404    10.88774
         54  |  -1.876172   5.551712    -0.34   0.742    -14.09541    10.34306
             |
        year |
         69  |  -4.499916   .7645174    -5.89   0.000    -6.182607   -2.817224
         70  |  -2.777827   .8890311    -3.12   0.010    -4.734572   -.8210832
         71  |  -4.445994   1.133686    -3.92   0.002    -6.941221   -1.950768
         72  |  -4.815259   1.104141    -4.36   0.001    -7.245456   -2.385062
         73  |  -5.642446   1.596996    -3.53   0.005    -9.157412    -2.12748
         75  |  -5.661095   2.565602    -2.21   0.050    -11.30795   -.0142444
         77  |  -6.360721   3.174019    -2.00   0.070    -13.34669    .6252475
         78  |  -6.055741   3.778596    -1.60   0.137    -14.37238    2.260894
         80  |  -6.124987   4.510804    -1.36   0.202     -16.0532    3.803225
         82  |  -6.552512   5.163855    -1.27   0.231    -17.91808    4.813055
         83  |  -6.498772   5.707029    -1.14   0.279    -19.05986    6.062314
         85  |  -6.033131   6.720564    -0.90   0.389    -20.82499    8.758729
         87  |  -5.975956   7.514976    -0.80   0.443    -22.51631    10.56439
         88  |  -6.022931   8.236795    -0.73   0.480    -24.15199    12.10613
             |
    ind_code |
          2  |   5.417113   .2053858    26.38   0.000     4.965062    5.869164
          3  |   1.588415   .0799617    19.86   0.000      1.41242    1.764409
          4  |   4.078755   .0720982    56.57   0.000     3.920068    4.237442
          5  |    2.77726   .0819129    33.91   0.000     2.596971    2.957549
          6  |  -.7259999   .0346239   -20.97   0.000    -.8022066   -.6497932
          7  |   2.126408   .0552342    38.50   0.000     2.004839    2.247978
          8  |   .3624576   .0497195     7.29   0.000     .2530257    .4718895
          9  |   -3.10053   .1501899   -20.64   0.000    -3.431096   -2.769964
         10  |  -2.693667   .1199612   -22.45   0.000      -2.9577   -2.429634
         11  |   1.225856   .0406933    30.12   0.000     1.136291    1.315421
         12  |   3.945356   .0422992    93.27   0.000     3.852256    4.038456
             |
       _cons |   41.76949   2.324664    17.97   0.000     36.65293    46.88604
------------------------------------------------------------------------------

```

### nlswork - using twowayjack

```{stata, echo=-1}
webuse nlswork, clear
keep if inrange(age,25,35)
gen vismin  = inrange(race,2,3)
twowayjack  hours vismin south   ,  fevar(age birth_yr year ind ) cluster(age ind)

TWOWAYJACK
Reference: James G. MacKinnon, Morten Ø. Nielsen, and Matthew D. Webb
           Jackknife inference with two-way clustering
 
Two-way cluster jackknife variance estimation.
Cluster summary statistics for vismin when clustered by age and ind_code.

Regression Output

    s.e. |      Coeff   Sd. Err.   t-stat  P value    CI-lower    CI-upper
---------+----------------------------------------------------------------
  CV1max |   1.054672   0.420220   2.5098   0.0309    0.223377    1.885967
  CV3max |   1.054672   0.521628   2.0219   0.0708   -0.107587    2.216931
--------------------------------------------------------------------------

Coefficients of Variation, G, and G*

 dimension |       Ng   Leverage  Partial L.   beta no g        G      Gstar
-----------+----------------------------------------------------------------
       age |   0.0987     0.1813      0.0927      0.0431       11      10.90
  ind_code |   1.1815     0.8823      1.1849      0.1565       12       5.21
 intersect |   1.1507     0.8925      1.1557      0.0173      132      56.26
----------------------------------------------------------------------------



```
